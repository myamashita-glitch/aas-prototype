<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>受験結果・評価一覧 - Prototype</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body class="min-h-screen bg-slate-50 text-slate-900">
    <script>
      if (localStorage.getItem("aas_logged_in") !== "1") {
        window.location.href = "./login.html";
      }
    </script>

    <header class="sticky top-0 z-50 bg-white/95 backdrop-blur border-b border-slate-200">
      <div class="mx-auto max-w-6xl px-6 py-4 flex items-center justify-between">
        <div class="leading-tight">
          <div class="text-xl font-semibold tracking-tight">SIGNATE AI Agent Simulation</div>
          <div class="text-sm text-slate-500">受験結果・評価一覧</div>
        </div>
        <nav class="flex items-center gap-3">
          <a href="./index.html" class="rounded-xl border border-slate-200 bg-white px-4 py-2 font-semibold text-slate-700 hover:bg-slate-50">
            シミュレーション一覧
          </a>
        </nav>
      </div>
    </header>

    <main class="mx-auto max-w-6xl px-6 py-8">
      <div class="flex items-center justify-between gap-3">
        <div>
          <h1 class="text-2xl font-extrabold tracking-tight">受験結果・評価一覧</h1>
          <p class="mt-1 text-slate-500 text-sm">提出（受験）ごとの結果を確認できます。</p>
        </div>

        <button class="rounded-xl border border-slate-200 bg-white hover:bg-slate-50 font-bold px-4 py-3" onclick="seedDemo(true)">
          デモ再生成
        </button>
      </div>

      <section class="mt-6 rounded-2xl bg-white border border-slate-200 shadow-sm overflow-hidden">
        <div class="overflow-auto">
          <table class="min-w-[820px] w-full">
            <thead class="bg-slate-50 border-b border-slate-200">
              <tr class="text-left text-xs font-extrabold text-slate-600">
                <th class="px-5 py-3">提出日時</th>
                <th class="px-5 py-3">シナリオ</th>
                <th class="px-5 py-3">状態</th>
                <th class="px-5 py-3">総合スコア</th>
                <th class="px-5 py-3"></th>
              </tr>
            </thead>
            <tbody id="rows"></tbody>
          </table>
        </div>
      </section>
    </main>

    <script>
      const STORAGE_KEY = "aas_results";

      function uid() {
        return Math.random().toString(36).slice(2, 10) + "-" + Date.now().toString(36);
      }
      function fmt(dt) {
        const d = new Date(dt);
        const y = d.getFullYear();
        const m = String(d.getMonth() + 1).padStart(2, "0");
        const day = String(d.getDate()).padStart(2, "0");
        const hh = String(d.getHours()).padStart(2, "0");
        const mm = String(d.getMinutes()).padStart(2, "0");
        return `${y}/${m}/${day} ${hh}:${mm}`;
      }

      function seedDemo(force = false) {
        const existing = localStorage.getItem(STORAGE_KEY);
        if (existing && !force) return;

        const demo = [
          {
            id: uid(),
            scenario: "マナビDX QUEST（ケース3）",
            case: "ケース3",
            status: "提出済",
            submittedAt: "2026-02-02T16:36:59+09:00",
            overall: 12,
          },
          {
            id: uid(),
            scenario: "マナビDX QUEST（ケース2）",
            case: "ケース2",
            status: "時間切れ",
            submittedAt: "2026-02-01T18:12:00+09:00",
            overall: 0,
          },
          {
            id: uid(),
            scenario: "マナビDX QUEST（ケース1）",
            case: "ケース1",
            status: "提出済",
            submittedAt: "2026-01-29T10:05:00+09:00",
            overall: 48,
          },
        ];
        localStorage.setItem(STORAGE_KEY, JSON.stringify(demo));
        render();
      }

      function load() {
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : [];
      }

      function badgeStatus(s) {
        if (s === "提出済") return `<span class="inline-flex items-center rounded-full bg-emerald-50 px-3 py-1 text-xs font-extrabold text-emerald-700 border border-emerald-100">提出済</span>`;
        if (s === "時間切れ") return `<span class="inline-flex items-center rounded-full bg-slate-100 px-3 py-1 text-xs font-extrabold text-slate-700 border border-slate-200">時間切れ</span>`;
        return `<span class="inline-flex items-center rounded-full bg-slate-100 px-3 py-1 text-xs font-extrabold text-slate-700 border border-slate-200">${s}</span>`;
      }

      function scorePill(score) {
        const cls =
          score >= 70 ? "bg-emerald-50 text-emerald-700 border-emerald-100" :
          score >= 40 ? "bg-amber-50 text-amber-700 border-amber-100" :
                        "bg-rose-50 text-rose-700 border-rose-100";
        return `<span class="inline-flex items-baseline gap-1 rounded-xl px-3 py-2 border ${cls}">
          <span class="text-xl font-extrabold">${score}</span>
          <span class="text-xs font-bold">/100</span>
        </span>`;
      }

      function render() {
        const items = load().sort((a,b)=> new Date(b.submittedAt)-new Date(a.submittedAt));
        const tbody = document.getElementById("rows");
        tbody.innerHTML = items.map(it => `
          <tr class="border-b border-slate-200 hover:bg-slate-50">
            <td class="px-5 py-4 text-sm text-slate-700 whitespace-nowrap">${fmt(it.submittedAt)}</td>
            <td class="px-5 py-4">
              <div class="font-extrabold">${it.scenario}</div>
              <div class="text-xs text-slate-500">${it.case}</div>
            </td>
            <td class="px-5 py-4">${badgeStatus(it.status)}</td>
            <td class="px-5 py-4">${scorePill(it.overall || 0)}</td>
            <td class="px-5 py-4 text-right">
              <a class="inline-flex items-center gap-2 rounded-xl bg-white border border-slate-200 px-4 py-2 font-bold text-slate-700 hover:bg-slate-50"
                 href="./result-detail.html?id=${encodeURIComponent(it.id)}">
                詳細 →
              </a>
            </td>
          </tr>
        `).join("");

        if (items.length === 0) {
          tbody.innerHTML = `<tr><td colspan="5" class="px-5 py-10 text-center text-slate-500">結果がありません。</td></tr>`;
        }
      }

      seedDemo(false);
      render();
    </script>
  </body>
</html>
