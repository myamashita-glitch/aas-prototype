<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>最終投稿 - Prototype</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body class="min-h-screen bg-[#EEF3FF] text-slate-900">
    <!-- （任意）ログインガード：不要ならこのscriptブロックごと削除OK -->
    <script>
      if (localStorage.getItem("aas_logged_in") !== "1") {
        // login.html が無ければ index.html に変更してください
        window.location.href = "./login.html";
      }
    </script>

    <main class="mx-auto max-w-[1200px] px-6 py-10">
      <!-- Header -->
      <div class="flex items-start justify-between">
        <h1 class="text-[44px] leading-none font-extrabold tracking-tight">最終投稿</h1>

        <button
          type="button"
          onclick="history.back()"
          class="inline-flex items-center gap-2 rounded-xl bg-slate-700 px-5 py-3 text-white font-bold shadow-sm hover:bg-slate-800 active:translate-y-[1px] transition"
          aria-label="戻る"
        >
          <span class="text-lg leading-none">←</span>
          <span>戻る</span>
        </button>
      </div>

      <!-- Card -->
      <section class="mt-8 rounded-2xl bg-white shadow-sm border border-slate-200 overflow-hidden">
        <div class="p-10">
          <h2 class="text-2xl font-extrabold">お客様への最終提案</h2>
          <p class="mt-3 text-slate-600">
            シミュレーションの状況を踏まえ、お客様への最終的な提案を記述してください。
          </p>

          <!-- Textarea -->
          <div class="mt-6 relative">
            <textarea
              id="finalText"
              maxlength="2000"
              class="w-full min-h-[360px] rounded-xl border border-slate-200 bg-white p-6 pr-24 text-[16px] leading-relaxed outline-none focus:ring-2 focus:ring-blue-100"
              placeholder="例：本日はご不便をおかけし大変申し訳ございませんでした。 代替品として、最新モデルの製品Aを無償で提供させていただきます。"
            ></textarea>

            <div class="absolute right-6 bottom-5 text-slate-400 font-semibold">
              <span id="count">0</span> / 2000文字
            </div>
          </div>

          <!-- Buttons -->
          <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
            <button
              type="button"
              onclick="goAdmin()"
              class="w-full rounded-xl bg-slate-500 px-6 py-5 text-white font-extrabold text-lg hover:bg-slate-600 active:translate-y-[1px] transition"
            >
              管理画面へ戻る
            </button>

            <button
              id="sendBtn"
              type="button"
              disabled
              onclick="sendPost()"
              class="w-full rounded-xl bg-slate-300 px-6 py-5 text-white font-extrabold text-lg cursor-not-allowed transition"
            >
              <span class="inline-flex items-center justify-center gap-3">
                <!-- paper plane icon -->
                <svg viewBox="0 0 24 24" class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M22 2 11 13" />
                  <path d="M22 2 15 22l-4-9-9-4 20-7Z" />
                </svg>
                投稿を送信
              </span>
            </button>
          </div>

          <p class="mt-6 text-center text-slate-500">
            この投稿は後から編集できません。よく確認してから送信してください。
          </p>
        </div>
      </section>
    </main>

    <script>
      const textarea = document.getElementById("finalText");
      const countEl = document.getElementById("count");
      const sendBtn = document.getElementById("sendBtn");
      const MAX = 2000;

      function refresh() {
        const len = textarea.value.length;
        countEl.textContent = String(len);

        const ok = textarea.value.trim().length > 0;
        sendBtn.disabled = !ok;
        sendBtn.className =
          "w-full rounded-xl px-6 py-5 text-white font-extrabold text-lg transition " +
          (ok
            ? "bg-slate-500 hover:bg-slate-600 active:translate-y-[1px]"
            : "bg-slate-300 cursor-not-allowed");
      }

      textarea.addEventListener("input", refresh);
      refresh();

      // 遷移先はプロジェクトに合わせて変更OK
      function goAdmin() {
        window.location.href = "./admin.html";
      }

      function sendPost() {
        const text = textarea.value.trim();
        if (!text) return;

        // プロトタイプ用：ローカルに保存して結果一覧へ（必要に応じて変更OK）
        localStorage.setItem("aas_latest_final_post", text);
        alert("プロトタイプ：投稿を送信しました（ダミー）");

        // results.html が無ければ、戻るだけでもOK
        window.location.href = "./results.html";
      }
    </script>
  </body>
</html>
